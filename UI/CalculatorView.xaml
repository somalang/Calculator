<Window x:Class="Calculator.UI.Views.CalculatorView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Calculator.UI.ViewModels"
        Title="계산기"
        Height="500"
        Width="320"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="White">

    <Window.DataContext>
        <vm:CalculatorViewModel />
    </Window.DataContext>
    <!-- Window.InputBindings 부분 수정 -->
    <Window.InputBindings>
        <KeyBinding Key="D0" Command="{Binding KeyPressCommand}" CommandParameter="D0"/>
        <KeyBinding Key="D1" Command="{Binding KeyPressCommand}" CommandParameter="D1"/>
        <KeyBinding Key="D2" Command="{Binding KeyPressCommand}" CommandParameter="D2"/>
        <KeyBinding Key="D3" Command="{Binding KeyPressCommand}" CommandParameter="D3"/>
        <KeyBinding Key="D4" Command="{Binding KeyPressCommand}" CommandParameter="D4"/>
        <KeyBinding Key="D5" Command="{Binding KeyPressCommand}" CommandParameter="D5"/>
        <KeyBinding Key="D6" Command="{Binding KeyPressCommand}" CommandParameter="D6"/>
        <KeyBinding Key="D7" Command="{Binding KeyPressCommand}" CommandParameter="D7"/>
        <KeyBinding Key="D8" Command="{Binding KeyPressCommand}" CommandParameter="D8"/>
        <KeyBinding Key="D9" Command="{Binding KeyPressCommand}" CommandParameter="D9"/>
        <KeyBinding Key="C" Modifiers="Control" Command="{Binding CopyCommand}" />
        <KeyBinding Key="V" Modifiers="Control" Command="{Binding PasteCommand}" />
        <!-- 숫자패드 키도 추가 -->
        <KeyBinding Key="NumPad0" Command="{Binding KeyPressCommand}" CommandParameter="NumPad0"/>
        <KeyBinding Key="NumPad1" Command="{Binding KeyPressCommand}" CommandParameter="NumPad1"/>
        <KeyBinding Key="NumPad2" Command="{Binding KeyPressCommand}" CommandParameter="NumPad2"/>
        <KeyBinding Key="NumPad3" Command="{Binding KeyPressCommand}" CommandParameter="NumPad3"/>
        <KeyBinding Key="NumPad4" Command="{Binding KeyPressCommand}" CommandParameter="NumPad4"/>
        <KeyBinding Key="NumPad5" Command="{Binding KeyPressCommand}" CommandParameter="NumPad5"/>
        <KeyBinding Key="NumPad6" Command="{Binding KeyPressCommand}" CommandParameter="NumPad6"/>
        <KeyBinding Key="NumPad7" Command="{Binding KeyPressCommand}" CommandParameter="NumPad7"/>
        <KeyBinding Key="NumPad8" Command="{Binding KeyPressCommand}" CommandParameter="NumPad8"/>
        <KeyBinding Key="NumPad9" Command="{Binding KeyPressCommand}" CommandParameter="NumPad9"/>

        <KeyBinding Key="OemPeriod" Command="{Binding KeyPressCommand}" CommandParameter="OemPeriod"/>
        <KeyBinding Key="Decimal" Command="{Binding KeyPressCommand}" CommandParameter="Decimal"/>
        <KeyBinding Key="OemPlus" Command="{Binding KeyPressCommand}" CommandParameter="OemPlus"/>
        <KeyBinding Key="Add" Command="{Binding KeyPressCommand}" CommandParameter="Add"/>
        <KeyBinding Key="OemMinus" Command="{Binding KeyPressCommand}" CommandParameter="OemMinus"/>
        <KeyBinding Key="Subtract" Command="{Binding KeyPressCommand}" CommandParameter="Subtract"/>
        <KeyBinding Key="Multiply" Command="{Binding KeyPressCommand}" CommandParameter="Multiply"/>
        <KeyBinding Key="Divide" Command="{Binding KeyPressCommand}" CommandParameter="Divide"/>
        <KeyBinding Key="OemQuestion" Command="{Binding KeyPressCommand}" CommandParameter="OemQuestion"/>
        <KeyBinding Key="Enter" Command="{Binding KeyPressCommand}" CommandParameter="Enter"/>
        <KeyBinding Key="Return" Command="{Binding KeyPressCommand}" CommandParameter="Return"/>
        <KeyBinding Key="Escape" Command="{Binding KeyPressCommand}" CommandParameter="Escape"/>
        <KeyBinding Key="Back" Command="{Binding KeyPressCommand}" CommandParameter="Back"/>
        <KeyBinding Key="Delete" Command="{Binding KeyPressCommand}" CommandParameter="Delete"/>
    </Window.InputBindings>
    <Window.Resources>
        <Style x:Key="BaseButtonStyle"
               TargetType="Button">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#D0D0D0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="NumberButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#F8F8F8" />
            <Setter Property="Foreground" Value="Black" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E8E8E8" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="OperatorButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#F8F8F8" />
            <Setter Property="Foreground" Value="Black" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E8E8E8" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FunctionButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#F0F0F0" />
            <Setter Property="Foreground" Value="Black" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0E0E0" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EqualsButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#4A90E2" />
            <Setter Property="Foreground" Value="White" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#357ABD" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CloseButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#4A90E2" />
            <Setter Property="Foreground" Value="White" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#357ABD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border CornerRadius="15"
            Background="White"
            BorderBrush="#D0D0D0"
            BorderThickness="1"
            Margin="5">
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="30" />
                <RowDefinition Height="101.01" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button Command="{Binding OpenMenuCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="0"
                        HorizontalAlignment="Left">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="#D0D0D0" Margin="3,0" />
                        <Ellipse Width="8" Height="8" Fill="#D0D0D0" Margin="3,0" />
                        <Ellipse Width="8" Height="8" Fill="#D0D0D0" Margin="3,0" />
                    </StackPanel>
                </Button>

                <Button Grid.Column="1" Width="30" Height="30" 
                        Command="{Binding ShowHistoryCommand}"
                        Style="{StaticResource FunctionButtonStyle}"
                        Margin="5,0,0,0" Focusable="False">
                    <Viewbox Width="16" Height="16">
                        <Canvas Width="24" Height="24">
                            <!-- 시계 아이콘 경로 -->
                            <Path Fill="Black"
                                  Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.7L16.2,16.2Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>
            </Grid>

            <Border Grid.Row="1"
        Background="#2C2C2C"
        CornerRadius="8"
        Margin="0,10,0,15">
                <TextBlock Text="{Binding DisplayTrimmed, Mode=OneWay}"
               FontSize="{Binding DisplayFontSize}" 
               Foreground="White"
               Background="Transparent"
               TextAlignment="Right"
               VerticalAlignment="Center"
               Padding="15,0"
               TextTrimming="CharacterEllipsis"
               TextWrapping="NoWrap" />
            </Border>


            <UniformGrid Grid.Row="2"
                         Rows="7"
                         Columns="4">
                <Button Content="%"
                        Command="{Binding PercentCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="CE"
                        Command="{Binding ClearCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="C"
                        Command="{Binding ClearAllCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="⌫"
                        Command="{Binding BackspaceCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>

                <Button Content="1/ₓ"
                        Command="{Binding ReciprocalCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="x²"
                        Command="{Binding SquareCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="√"
                        Command="{Binding SqrtCommand}"
                        Style="{StaticResource FunctionButtonStyle}" Focusable="False"/>
                <Button Content="/"
                        Command="{Binding OperatorCommand}"
                        CommandParameter="/"
                        Style="{StaticResource OperatorButtonStyle}" Focusable="False"/>

                <Button Content="7"
                        Command="{Binding NumberCommand}"
                        CommandParameter="7"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="8"
                        Command="{Binding NumberCommand}"
                        CommandParameter="8"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="9"
                        Command="{Binding NumberCommand}"
                        CommandParameter="9"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="*"
                        Command="{Binding OperatorCommand}"
                        CommandParameter="*"
                        Style="{StaticResource OperatorButtonStyle}" Focusable="False"/>

                <Button Content="4"
                        Command="{Binding NumberCommand}"
                        CommandParameter="4"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="5"
                        Command="{Binding NumberCommand}"
                        CommandParameter="5"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="6"
                        Command="{Binding NumberCommand}"
                        CommandParameter="6"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="-"
                        Command="{Binding OperatorCommand}"
                        CommandParameter="-"
                        Style="{StaticResource OperatorButtonStyle}" Focusable="False"/>

                <Button Content="1"
                        Command="{Binding NumberCommand}"
                        CommandParameter="1"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="2"
                        Command="{Binding NumberCommand}"
                        CommandParameter="2"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="3"
                        Command="{Binding NumberCommand}"
                        CommandParameter="3"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="+"
                        Command="{Binding OperatorCommand}"
                        CommandParameter="+"
                        Style="{StaticResource OperatorButtonStyle}" Focusable="False"/>

                <!-- +/- command button -->
                <Button Content="+/-"
                        Command="{Binding ToggleSignCommand}"
                        CommandParameter="+/-"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="0"
                        Command="{Binding NumberCommand}"
                        CommandParameter="0"
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="."
                        Command="{Binding NumberCommand}"
                        CommandParameter="."
                        Style="{StaticResource NumberButtonStyle}" Focusable="False"/>
                <Button Content="="
                        Command="{Binding EqualsCommand}"
                        Style="{StaticResource EqualsButtonStyle}" />
                <!-- Close Button -->
                <Button Content="Close" 
                         Command="{Binding CloseCommand}"
                         Style="{StaticResource CloseButtonStyle}" Margin="2,2,-208,0" />

            </UniformGrid>
        </Grid>
    </Border>
</Window>
